@model List<Milton.Models.Apps>

@{
    ViewBag.Title = "Home";

}

@section contents{
    <link href="~/Scripts/plugins/morris/morris.css" rel="stylesheet">
    <link href="~/Scripts/plugins/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css" rel="stylesheet">
    <link href="~/Scripts/plugins/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">
}

<div class="row">
    <div class="col-sm-12">
        <div class="page-title-box">
            <h4 class="page-title">Bop General Report</h4>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-12">
        <label class="control-label col-sm-4">Select the App</label>
        <div class="col-sm-8">
            <select id="AppSelect" class="form-control">
                @foreach (var val in Model)
                {
                <option value="@val.Id">@val.Name</option>
                }
            </select>
        </div>
    </div>
</div>
<hr />
<div class="row">
    <div class="col-lg-12">
        <label class="control-label col-sm-4">Select the dates range</label>
        <div class="col-sm-8">
            <div class="input-daterange input-group" id="date-range">
                <span class="input-group-addon bg-primary b-0 text-white">Del</span>
                <input type="text" class="form-control fromDate" name="start">
                <span class="input-group-addon bg-primary b-0 text-white">Al</span>
                <input type="text" class="form-control toDate" name="end">
            </div>
        </div>
        <input type="submit" class="btn btn-primary" value="Generate Report" id="ss_btn" style="float: right; margin-top: 1pc; margin-bottom: 1pc;" onclick="GetInfo();" />
    </div>
</div>
<div class="row">
    <div class="col-sm-6 col-lg-3">
        <div class="widget-bg-color-icon card-box">
            <div class="bg-icon bg-icon-success pull-left">
                <i class="ti-eye text-success"></i>
            </div>
            <div class="text-right">
                <h3 class="text-dark" id="l1"></h3>
                <p class="text-muted">Activations</p>
            </div>
            <div class="clearfix"></div>
        </div>
    </div>
    <div class="col-sm-6 col-lg-3">
        <div class="widget-bg-color-icon card-box fadeInDown animated">
            <div class="bg-icon bg-icon-primary pull-left">
                <i class="ti-eye text-success"></i>
            </div>
            <div class="text-right">
                <h3 class="text-dark" id="l2">0</h3>
                <p class="text-muted">Cancellations</p>
            </div>
            <div class="clearfix"></div>
        </div>
    </div>

    <div class="col-sm-6 col-lg-3">
        <div class="widget-bg-color-icon card-box">
            <div class="bg-icon bg-icon-danger pull-left">
                <i class="ti-money text-info"></i>
            </div>
            <div class="text-right">
                <h3 class="text-dark" id="l3"></h3>
                <p class="text-muted">Subscribers</p>
            </div>
            <div class="clearfix"></div>
        </div>
    </div>

    <div class="col-sm-6 col-lg-3">
        <div class="widget-bg-color-icon card-box">
            <div class="bg-icon bg-icon-purple pull-left">
                <i class="ti-stats-up text-purple"></i>
            </div>
            <div class="text-right">
                <h3 class="text-dark" id="l4"></h3>
                <p class="text-muted">Charged</p>
            </div>
            <div class="clearfix"></div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-8">
        <div class="card-box">
            <h4 class="text-dark  header-title m-t-0 m-b-30" id="titleCpMetrics">Metrics</h4>
            <div class="widget-chart text-center">
                <div id="dashboard-chart-1" style="height: 200px;"></div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card-box">
            <h4 class="text-dark  header-title m-t-0 m-b-30">Subscribers by Company</h4>
            <div class="widget-chart text-center">
                <div id="morris-donut-example" style="height: 200px;"></div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-lg-8">
        <div class="card-box">
            <h4 class="text-dark  header-title m-t-0">Metrics Detail</h4>
            <div class="table-responsive">
                <table class="table" id="financialReport">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Subscription</th>
                            <th>Charged</th>
                            <th>Active</th>
                            <th>Daily Charged</th>
                            <th>Repeated Charged</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
    <!-- end col -8 -->

</div>
<!-- end row -->
@section scripts{
    <script src="@Url.Content("~/Scripts/plugins/d3/d3.min.js")"></script>
    <script src="@Url.Content("~/Scripts/plugins/nvd3/build/nv.d3.min.js")"></script>
    <script src="@Url.Content("~/Scripts/plugins/datatables/dataTables.scroller.min.js")"></script>
    <script src="@Url.Content("~/Scripts/plugins/datatables/jquery.dataTables.min.js")"></script>
    <script src="@Url.Content("~/Scripts/plugins/datatables/dataTables.bootstrap.js")"></script>
    <script src="@Url.Content("~/Scripts/plugins/datatables/dataTables.buttons.min.js")"></script>
    <script src="@Url.Content("~/Scripts/plugins/datatables/buttons.bootstrap.min.js")"></script>
    <script src="@Url.Content("~/Scripts/plugins/datatables/jszip.min.js")"></script>
    <script src="@Url.Content("~/Scripts/plugins/datatables/pdfmake.min.js")"></script>
    <script src="@Url.Content("~/Scripts/plugins/datatables/vfs_fonts.js")"></script>
    <script src="@Url.Content("~/Scripts/plugins/datatables/buttons.html5.min.js")"></script>
    <script src="@Url.Content("~/Scripts/plugins/datatables/buttons.print.min.js")"></script>
    <script src="@Url.Content("~/Scripts/plugins/datatables/dataTables.fixedHeader.min.js")"></script>
    <script src="@Url.Content("~/Scripts/plugins/datatables/dataTables.keyTable.min.js")"></script>
    <script src="@Url.Content("~/Scripts/plugins/datatables/dataTables.responsive.min.js")"></script>
    <script src="@Url.Content("~/Scripts/plugins/datatables/responsive.bootstrap.min.js")"></script>
    <script src="@Url.Content("~/Scripts/plugins/datatables/dataTables.scroller.min.js")"></script>
    <script src="@Url.Content("~/Scripts/plugins/moment/moment.js")"></script>

    <link href="~/Scripts/plugins/datatables/fixedHeader.bootstrap.min.css" rel="stylesheet" />
    <link href="~/Scripts/plugins/datatables/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="~/Scripts/plugins/datatables/responsive.bootstrap.min.css" rel="stylesheet" />
    <link href="~/Scripts/plugins/datatables/scroller.bootstrap.min.css" rel="stylesheet" />
    <link href="~/Scripts/plugins/datatables/buttons.bootstrap.min.css" rel="stylesheet" />
    <script src="~/Scripts/plugins/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
    <script src="~/Scripts/plugins/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
    <script src="~/Scripts/plugins/bootstrap-daterangepicker/daterangepicker.js"></script>

    <script type="text/javascript">
        $(document).ready(
            function ($) {
                const df = new Date();
                const dt = new Date();
                const asdF = (df.getMonth() + 1) + '-' + df.getDate() + '-' + df.getFullYear();
                const asdT = (df.getMonth() + 1) + '-' + df.getDate() + '-' + df.getFullYear();
                $('.fromDate').val(asdF);
                $('.toDate').val(asdT);
                $('#date-range').datepicker({
                    toggleActive: true,
                    dateFormat: 'yyyy/MM/dd',
                    language: 'en'
                });
                GetInfo();
            });
        function GetInfo() {
            const df = new Date($('.fromDate').val());
            const dt = new Date($('.toDate').val());
            const asdF = df.getFullYear() + '-' + (df.getMonth() + 1) + '-' + df.getDate();
            const asdT = dt.getFullYear() + '-' + (dt.getMonth() + 1) + '-' + dt.getDate();
            $.ajax({
                url: "/Home/acti?appId=" + $('#AppSelect').val() + "&initialDate=" + asdF + "&endDate=" + asdT,
                success: function (data) {
                    $("#l1").html("<b class='counter'>" + data.Registered + "</b>");
                    $("#l3").html("<b class='counter'>" + data.SubcribedUsers + "</b>");
                    $("#l4").html("<b class='counter'>" + data.Charged + "</b>");
                    $('#titleCpMetrics').html($('#AppSelect option:selected').text() + ' Metrics');
                    //Graph table
                    if (data.ReportGeneral.length > 0) {
                        var tbOne = $("#financialReport");
                        var columns = [
                            { data: 'Fecha', className: "left" },
                            { data: 'Suscripciones', className: "center" },
                            { data: 'Registrados', className: "center" },
                            { data: 'registrados_con_pago_activo', className: "center" },
                            { data: 'daily_charged', className: "center" },
                            { data: 'repeat_charged', className: "center" }
                        ];
                        tbOne.DataTable({
                            columns: columns,
                            data: data.ReportGeneral,
                            buttons: [{
                                extend: "excel",
                                className: "btn-sm"
                            }, {
                                extend: "pdf",
                                className: "btn-sm"
                            }],
                            dom: "Bfrtip",
                            responsive: !0
                        });
                    }
                    debugger;
                },
                error: function (xhr) {
                    debugger;
                },
                type: "GET",
                dataType: 'json',
                contentType: "application/json; charset=utf-8"
            });
            var getColor = function (type) {
                var color;
                switch (type) {
                    case 1:
                        color = generateColor();
                        if (!repColorsOne.includes(color)) {
                            repColorsOne.push(color);
                            return color;
                        }
                        getColor(1);
                        break;
                    case 2:
                        color = generateColor();
                        if (!repColorsTwo.includes(color)) {
                            repColorsTwo.push(color);
                            return color;
                        }
                        getColor(2);
                        break;
                }
                return '#000000';
            }
            var generateColor = function () {
                return "#" + Math.floor(Math.random() * 16777215).toString(16);
            }
        }
    </script>
}